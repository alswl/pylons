<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration &mdash; Pylons Framework 1.1 documentation</title>
    
    <link rel="stylesheet" href="_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pylons Framework 1.1 documentation" href="index.html" />
    <link rel="next" title="Logging" href="logging.html" />
    <link rel="prev" title="Advanced Models" href="advanced_models.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="_static/pylons.ico"/>

  </head>
  <body role="document">







<div class="header-small">
	
	<div class="logo-small">
		<a href="index.html">
      		<img class="logo" src="_static/pylonsfw-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="logging.html" title="Logging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="advanced_models.html" title="Advanced Models"
             accesskey="P">previous</a> |</li>
    	<li><a href="index.html">Pylons Framework 1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>Pylons comes with two main ways to configure an application:</p>
<ul class="simple">
<li>The configuration file (<a class="reference internal" href="#run-config"><span class="std std-ref">Runtime Configuration</span></a>)</li>
<li>The application&#8217;s <code class="docutils literal"><span class="pre">config</span></code> directory</li>
</ul>
<p>The files in the <code class="docutils literal"><span class="pre">config</span></code> directory change certain aspects of how the application behaves. Any options that the webmaster should be able to change during deployment should be specified in a configuration file.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">A good indicator of whether an option should be set in the <code class="docutils literal"><span class="pre">config</span></code> directory code vs. the configuration file is whether or not the option is necessary for the functioning of the application. If the application won&#8217;t function without the setting, it belongs in the appropriate <code class="file docutils literal"><span class="pre">config/</span></code> directory file. If the option should be changed depending on deployment, it belongs in the <a class="reference internal" href="#run-config"><span class="std std-ref">Runtime Configuration</span></a>.</p>
</div>
<p>The applications <code class="file docutils literal"><span class="pre">config/</span></code> directory includes:</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">config/environment.py</span></code> described in <a class="reference internal" href="#environment-config"><span class="std std-ref">Environment</span></a></li>
<li><code class="file docutils literal"><span class="pre">config/middleware.py</span></code> described in <a class="reference internal" href="#middleware-config"><span class="std std-ref">Middleware</span></a></li>
<li><code class="file docutils literal"><span class="pre">config/deployment.ini_tmpl</span></code> described in <a class="reference internal" href="#production-config"><span class="std std-ref">Production Configuration Files</span></a></li>
<li><code class="file docutils literal"><span class="pre">config/routing.py</span></code> described in <a class="reference internal" href="#url-config"><span class="std std-ref">URL Configuration</span></a></li>
</ul>
<p>Each of these files allows developers to change key aspects of how the application behaves.</p>
<div class="section" id="runtime-configuration">
<span id="run-config"></span><h2>Runtime Configuration<a class="headerlink" href="#runtime-configuration" title="Permalink to this headline">¶</a></h2>
<p>When a new project is created a sample configuration file called <code class="file docutils literal"><span class="pre">development.ini</span></code> is automatically produced as one of the project files. This default configuration file contains sensible options for development use, for example when developing a Pylons application it is very useful to be able to see a debug report every time an error occurs. The <code class="file docutils literal"><span class="pre">development.ini</span></code> file includes options to enable debug mode so these errors are shown.</p>
<p>Since the configuration file is used to determine which application is run, multiple configuration files can be used to easily toggle sets of options. Typically a developer might have a <code class="docutils literal"><span class="pre">development.ini</span></code> configuration file for testing and a <code class="docutils literal"><span class="pre">production.ini</span></code> file produced by the <strong class="command">paster make-config</strong> command for testing the command produces sensible production output. A <code class="file docutils literal"><span class="pre">test.ini</span></code> configuration is also included in the project for test-specific options.</p>
<p>To specify a configuration file to use when running the application, change the last part of the <strong class="command">paster serve</strong> to include the desired config file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster serve production.ini
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Configuration file format <strong>and options</strong> are described in great detail in the <a class="reference external" href="http://pythonpaste.org/deploy/">Paste Deploy documentation</a>.</p>
</div>
<div class="section" id="getting-information-from-configuration-files">
<h3>Getting Information From Configuration Files<a class="headerlink" href="#getting-information-from-configuration-files" title="Permalink to this headline">¶</a></h3>
<p>All information from the configuration file is available in the <code class="docutils literal"><span class="pre">pylons.config</span></code> object. <code class="docutils literal"><span class="pre">pylons.config</span></code> also contains application configuration as defined in the project&#8217;s <code class="file docutils literal"><span class="pre">config.environment</span></code> module.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylons</span> <span class="kn">import</span> <span class="n">config</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">pylons.config</span></code> behaves like a dictionary. For example, if the configuration file has an entry under the <code class="docutils literal"><span class="pre">[app:main]</span></code> block:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="na">cache_dir</span> <span class="o">=</span> <span class="s">%(here)s/data</span>
</pre></div>
</div>
<p>That can then be read in the projects code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylons</span> <span class="kn">import</span> <span class="n">config</span>
<span class="n">cache_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;cache.dir&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Or the current debug status like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">debug</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;debug&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="evaluating-non-string-data-in-configuration-files">
<h4>Evaluating Non-string Data in Configuration Files<a class="headerlink" href="#evaluating-non-string-data-in-configuration-files" title="Permalink to this headline">¶</a></h4>
<p>By default, all the values in the configuration file are considered strings.
To make it easier to handle boolean values, the Paste library comes with a
function that will convert <code class="docutils literal"><span class="pre">true</span></code> and <code class="docutils literal"><span class="pre">false</span></code> to proper Python boolean
values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">paste.deploy.converters</span> <span class="kn">import</span> <span class="n">asbool</span>

<span class="n">debug</span> <span class="o">=</span> <span class="n">asbool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;debug&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This is used already in the default projects&#8217; <a class="reference internal" href="#middleware-config"><span class="std std-ref">Middleware</span></a> to
toggle middleware that should only be used in development mode (with
<code class="docutils literal"><span class="pre">debug</span></code>) set to true.</p>
</div>
</div>
<div class="section" id="production-configuration-files">
<span id="production-config"></span><h3>Production Configuration Files<a class="headerlink" href="#production-configuration-files" title="Permalink to this headline">¶</a></h3>
<p>To change the defaults of the configuration INI file that should be used when deploying the application, edit the <code class="file docutils literal"><span class="pre">config/deployment.ini_tmpl</span></code> file. This is the file that will be used as a template during deployment, so that the person handling deployment has a starting point of the minimum options the application needs set.</p>
<p>One of the most important options set in the deployment ini is the <code class="docutils literal"><span class="pre">debug</span> <span class="pre">=</span> <span class="pre">true</span></code> setting. The email options should be setup so that errors can be e-mailed to the appropriate developers or webmaster in the event of an application error.</p>
<div class="section" id="generating-the-production-configuration">
<h4>Generating the Production Configuration<a class="headerlink" href="#generating-the-production-configuration" title="Permalink to this headline">¶</a></h4>
<p>To generate the production.ini file from the projects&#8217; <code class="file docutils literal"><span class="pre">config/deployment.ini_tmpl</span></code> it must first be installed either as an <a class="reference internal" href="glossary.html#term-egg"><span class="xref std std-term">egg</span></a> or under development mode. Assuming the name of the Pylons application is <code class="docutils literal"><span class="pre">helloworld</span></code>, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster make-config helloworld production.ini
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command will also work from inside the project when its being developed.</p>
</div>
<p>It is the responsibility of the developer to ensure that a sensible set of default configuration values exist when the webmaster uses the <code class="docutils literal"><span class="pre">paster</span> <span class="pre">make-config</span></code> command.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Always</strong> make sure that the <code class="docutils literal"><span class="pre">debug</span></code> is set to <code class="docutils literal"><span class="pre">false</span></code> when deploying a Pylons application.</p>
</div>
</div>
</div>
</div>
<div class="section" id="environment">
<span id="environment-config"></span><h2>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<p>The <code class="file docutils literal"><span class="pre">config/environment.py</span></code> module sets up the basic Pylons environment
variables needed to run the application. Objects that should be setup once
for the entire application should either be setup here, or in the
<code class="file docutils literal"><span class="pre">lib/app_globals</span></code> <code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code> method.</p>
<p>It also calls the <a class="reference internal" href="#url-config"><span class="std std-ref">URL Configuration</span></a> function to setup how the URL&#8217;s will
be matched up to <a class="reference internal" href="controllers.html#controllers"><span class="std std-ref">控制器</span></a>, creates the <a class="reference internal" href="glossary.html#term-app-globals"><span class="xref std std-term">app_globals</span></a>
object, configures which module will be referred to as <a class="reference internal" href="glossary.html#term-h"><span class="xref std std-term">h</span></a>, and is
where the template engine is setup.</p>
<p>When using SQLAlchemy it&#8217;s recommended that the SQLAlchemy engine be setup
in this module. The default SQLAlchemy configuration that Pylons comes
with creates the engine here which is then used in <code class="file docutils literal"><span class="pre">model/__init__.py</span></code>.</p>
</div>
<div class="section" id="url-configuration">
<span id="url-config"></span><h2>URL Configuration<a class="headerlink" href="#url-configuration" title="Permalink to this headline">¶</a></h2>
<p>A Python library called Routes handles mapping URLs to controllers and their methods, or their <a class="reference internal" href="glossary.html#term-action"><span class="xref std std-term">action</span></a> as Routes refers to them. By default, Pylons sets up the following <a class="reference internal" href="glossary.html#term-route"><span class="xref std std-term">route</span></a>s (found in <code class="file docutils literal"><span class="pre">config/routing.py</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{controller}/{action}&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{controller}/{action}/{id}&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 0.9.7: </span>Prior to Routes 1.9, all map.connect statements required variable parts
to begin with a <code class="docutils literal"><span class="pre">:</span></code> like <code class="docutils literal"><span class="pre">map.connect(':controller/:action')</span></code>. This
syntax is now optional, and the new <code class="docutils literal"><span class="pre">{}</span></code> syntax is recommended.</p>
</div>
<p>Any part of the path inside the curly braces is a variable (a <cite>variable part</cite>
) that will match
any text in the URL for that &#8216;part&#8217;. A &#8216;part&#8217; of the URL is the text between
two forward slashes. Every part of the URL must be present for the
<a class="reference internal" href="glossary.html#term-route"><span class="xref std std-term">route</span></a> to match, otherwise a 404 will be returned.</p>
<p>The routes above are translated by the Routes library into regular expressions
for high performance URL matching. By default, all the variable parts (except
for the special case of <code class="docutils literal"><span class="pre">{controller}</span></code>) become a matching regular expression
of <code class="docutils literal"><span class="pre">[^/]+</span></code> to match anything except for a forward slash. This can be
changed easily, for example to have the <code class="docutils literal"><span class="pre">{id}</span></code> only match digits:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{controller}/{action}/{id:\d+}&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the desired regular expression includes the <code class="docutils literal"><span class="pre">{}</span></code>, then it should be
specified separately for the variable part. To limit the <code class="docutils literal"><span class="pre">{id}</span></code> to only
match at least 2-4 digits:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{controller}/{action}/{id}&#39;</span><span class="p">,</span>  <span class="n">requirements</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">&#39;\d{2,4}&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The controller and action can also be specified as keyword arguments so that
they don&#8217;t need to be included in the URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Archives by 2 digit year -&gt; /archives/08</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/archives/{year:\d\d}&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;articles&#39;</span><span class="p">,</span>  <span class="n">action</span><span class="o">=</span><span class="s">&#39;archives&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Any variable part, or keyword argument in the <code class="docutils literal"><span class="pre">map.connect</span></code> statement will
be available for use in the
action used. For the route above, which resolves to the <cite>articles</cite>
controller:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArticlesController</span><span class="p">(</span><span class="n">BaseController</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">archives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The part of the URL that matched as the year is available by name in the
function argument.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Routes also includes the ability to attempt to &#8216;minimize&#8217; the URL. This
behavior is generally not intuitive, and starting in Pylons 0.9.7 is
turned off by default with the <code class="docutils literal"><span class="pre">map.minimization=False</span></code> setting.</p>
</div>
<p>The default mapping can match to any controller and any of their
actions which means the following URLs will match:</p>
<div class="highlight-text"><div class="highlight"><pre>/hello/index       &gt;&gt;    controller: hello, action: index
/entry/view/4      &gt;&gt;    controller: entry, action: view, id:4
/comment/edit/2    &gt;&gt;    controller: comment, action: edit, id:2
</pre></div>
</div>
<p>This simple scheme can be suitable for even large applications when complex URL&#8217;s aren&#8217;t needed.</p>
<p>Controllers can be organized into directories as well. For example, if the admins should have a separate <code class="docutils literal"><span class="pre">comments</span></code> controller:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster controller admin/comments
</pre></div>
</div>
<p>Will create the <code class="docutils literal"><span class="pre">admin</span></code> directory along with the appropriate <code class="docutils literal"><span class="pre">comments</span></code>
controller under it. To get to the comments controller:</p>
<div class="highlight-text"><div class="highlight"><pre>/admin/comments/index    &gt;&gt;    controller: admin/comments, action: index
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">{controller}</span></code> match is special, in that it doesn&#8217;t always stop
at the next forward slash (<code class="docutils literal"><span class="pre">/</span></code>). As the example above demonstrates,
it is able to match controllers nested under a directory should they
exist.</p>
</div>
<div class="section" id="adding-a-route-to-match">
<h3>Adding a route to match <code class="docutils literal"><span class="pre">/</span></code><a class="headerlink" href="#adding-a-route-to-match" title="Permalink to this headline">¶</a></h3>
<p>The controller and action can be specified directly in the <code class="xref py py-meth docutils literal"><span class="pre">map.connect()</span></code>
statement, as well as the raw URL to be matched:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;main&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>results in <code class="docutils literal"><span class="pre">/</span></code> being handled by the <code class="docutils literal"><span class="pre">index</span></code> method of the <code class="docutils literal"><span class="pre">main</span></code>
controller.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, projects&#8217; static files (in the <code class="file docutils literal"><span class="pre">public/</span></code> directory) are
served in preference to controllers. New Pylons projects include a welcome
page (<code class="file docutils literal"><span class="pre">public/index.html</span></code>) that shows up at the <code class="docutils literal"><span class="pre">/</span></code> url. You&#8217;ll
want to remove this file before mapping a route there.</p>
</div>
</div>
<div class="section" id="generating-urls">
<h3>Generating URLs<a class="headerlink" href="#generating-urls" title="Permalink to this headline">¶</a></h3>
<p>URLs are generated via the callable <code class="xref py py-class docutils literal"><span class="pre">routes.util.URLGenerator</span></code>
object. Pylons provides an instance of this special object at
<code class="xref py py-data docutils literal"><span class="pre">pylons.url</span></code>. It accepts keyword arguments indicating the desired
controller, action and additional variables defined in a route.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># generates /content/view/2</span>
<span class="n">url</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;view&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>To generate the URL of the matched route of the current request, call
<code class="xref py py-meth docutils literal"><span class="pre">routes.util.URLGenerator.current()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Generates /content/view/3 during a request for /content/view/3</span>
<span class="n">url</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal"><span class="pre">routes.util.URLGenerator.current()</span></code> also accepts the same arguments as
<cite>url()</cite>. This uses <a class="reference external" href="http://routes.groovie.org/manual.html#route-memory">Routes memory</a> to generate a small
change to the current URL without the need to specify all the relevant
arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Generates /content/view/2 during a request for /content/view/3</span>
<span class="n">url</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://routes.groovie.org/manual.html">Routes manual</a>
Full details and source code.</p>
</div>
</div>
</div>
<div class="section" id="middleware">
<span id="middleware-config"></span><h2>Middleware<a class="headerlink" href="#middleware" title="Permalink to this headline">¶</a></h2>
<p>A projects WSGI stack should be setup in the <code class="file docutils literal"><span class="pre">config/middleware.py</span></code>
module. Ideally this file should import middleware it needs, and set it up
in the <cite>make_app</cite> function.</p>
<p>The default stack that is setup for a Pylons application is described in
detail in <a class="reference internal" href="concepts.html#wsgi-middleware"><span class="std std-ref">WSGI 中间件</span></a>.</p>
<p>Default middleware stack:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># The Pylons WSGI app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">PylonsApp</span><span class="p">()</span>

<span class="c"># Routing/Session/Cache Middleware</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">RoutesMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;routes.map&#39;</span><span class="p">])</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">SessionMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">CacheMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

<span class="c"># CUSTOM MIDDLEWARE HERE (filtered by error handling middlewares)</span>

<span class="k">if</span> <span class="n">asbool</span><span class="p">(</span><span class="n">full_stack</span><span class="p">):</span>
    <span class="c"># Handle Python exceptions</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">ErrorHandler</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">global_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;pylons.errorware&#39;</span><span class="p">])</span>

    <span class="c"># Display error documents for 401, 403, 404 status codes (and</span>
    <span class="c"># 500 when debug is disabled)</span>
    <span class="k">if</span> <span class="n">asbool</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;debug&#39;</span><span class="p">]):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">StatusCodeRedirect</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">StatusCodeRedirect</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="mi">403</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>

<span class="c"># Establish the Registry for this application</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">RegistryManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="k">if</span> <span class="n">asbool</span><span class="p">(</span><span class="n">static_files</span><span class="p">):</span>
    <span class="c"># Serve static files</span>
    <span class="n">static_app</span> <span class="o">=</span> <span class="n">StaticURLParser</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;pylons.paths&#39;</span><span class="p">][</span><span class="s">&#39;static_files&#39;</span><span class="p">])</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Cascade</span><span class="p">([</span><span class="n">static_app</span><span class="p">,</span> <span class="n">app</span><span class="p">])</span>

<span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>Since each piece of middleware wraps the one before it, the stack needs to be
assembled in reverse order from the order in which its called. That is, the
very last middleware that wraps the WSGI Application, is the very first that
will be called by the server.</p>
<p>The last piece of middleware in the stack, called Cascade, is used to
serve static content files during development. For top performance,
consider disabling the Cascade middleware via setting the
<code class="docutils literal"><span class="pre">static_files</span> <span class="pre">=</span> <span class="pre">false</span></code> in the configuration file. Then have the
webserver or a <a class="reference internal" href="glossary.html#term-cdn"><span class="xref std std-term">CDN</span></a> serve static files.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When unsure about whether or not to change the middleware, <strong>don&#8217;t</strong>. The
order of the middleware is important to the proper functioning of a
Pylons application, and shouldn&#8217;t be altered unless needed.</p>
</div>
<div class="section" id="adding-custom-middleware">
<h3>Adding custom middleware<a class="headerlink" href="#adding-custom-middleware" title="Permalink to this headline">¶</a></h3>
<p>Custom middleware should be included in the <code class="file docutils literal"><span class="pre">config/middleware.py</span></code> at
comment marker:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># CUSTOM MIDDLEWARE HERE (filtered by error handling middlewares)</span>
</pre></div>
</div>
<p>For example, to add a middleware component named <cite>MyMiddleware</cite>,
include it in <code class="file docutils literal"><span class="pre">config/middleware.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># The Pylons WSGI app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">PylonsApp</span><span class="p">()</span>

<span class="c"># Routing/Session/Cache Middleware</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">RoutesMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;routes.map&#39;</span><span class="p">])</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">SessionMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">CacheMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

<span class="c"># CUSTOM MIDDLEWARE HERE (filtered by error handling middlewares)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">MyMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>The app object is simply passed as a parameter to the <cite>MyMiddleware</cite> middleware which in turn should return a wrapped WSGI application.</p>
<p>Care should be taken when deciding in which layer to place custom
middleware. In most cases middleware should be placed before the Pylons WSGI
application and its supporting Routes/Session/Cache middlewares, however if the
middleware should run <em>after</em> the CacheMiddleware:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Routing/Session/Cache Middleware</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">RoutesMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;routes.map&#39;</span><span class="p">])</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">SessionMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

<span class="c"># MyMiddleware can only see the cache object, nothing *above* here</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">MyMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">CacheMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="what-is-full-stack">
<h3>What is full_stack?<a class="headerlink" href="#what-is-full-stack" title="Permalink to this headline">¶</a></h3>
<p>In the Pylons ini file {<code class="file docutils literal"><span class="pre">development.ini</span></code> or <code class="file docutils literal"><span class="pre">production.ini</span></code>} this block determines if the flag full_stack is set to true or false:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[</span><span class="n">app</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">app_name</span>
<span class="n">full_stack</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>The full_stack flag determines if the ErrorHandler and StatusCodeRedirect is included as a layer in the middleware wrapping process. The only condition in which this option would be set to <cite>false</cite> is if multiple Pylons applications are running and will be wrapped in the appropriate middleware elsewhere.</p>
</div>
</div>
<div class="section" id="application-setup">
<span id="setup-config"></span><h2>Application Setup<a class="headerlink" href="#application-setup" title="Permalink to this headline">¶</a></h2>
<p>There are two kinds of &#8216;Application Setup&#8217; that are occasionally referenced
with regards to a project using Pylons.</p>
<ul class="simple">
<li>Setting up a new application</li>
<li>Configuring project information and package dependencies</li>
</ul>
<div class="section" id="setting-up-a-new-application">
<h3>Setting Up a New Application<a class="headerlink" href="#setting-up-a-new-application" title="Permalink to this headline">¶</a></h3>
<p>To make it easier to setup a new instance of a project, such as setting up
the basic database schema, populating necessary defaults, etc. a setup
script can be created.</p>
<p>In a Pylons project, the setup script to be run is located in the projects&#8217;
<code class="file docutils literal"><span class="pre">websetup.py</span></code> file. The default script loads the projects configuration
to make it easier to write application setup steps:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">helloworld.config.environment</span> <span class="kn">import</span> <span class="n">load_environment</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup_app</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="nb">vars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Place any commands to setup helloworld here&quot;&quot;&quot;</span>
    <span class="n">load_environment</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">global_conf</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">local_conf</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the project was configured during creation to use SQLAlchemy this file
will include some commands to setup the database connection to make it
easier to setup database tables.</p>
</div>
<p>To run the setup script using the development configuration:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster setup-app development.ini
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-package">
<h3>Configuring the Package<a class="headerlink" href="#configuring-the-package" title="Permalink to this headline">¶</a></h3>
<p>A newly created project with Pylons is a standard Python package. As a Python
package, it has a <code class="file docutils literal"><span class="pre">setup.py</span></code> file that records meta-information about
the package. Most of the options in it are fairly self-explanatory, the most
important being the &#8216;install_requires&#8217; option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
    <span class="s">&quot;Pylons&gt;=0.9.7&quot;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>
</div>
<p>These lines indicate what packages are required for the proper functioning
of the application, and should be updated as needed. To re-parse the
<code class="file docutils literal"><span class="pre">setup.py</span></code> line for new dependencies:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python setup.py develop
</pre></div>
</div>
<p>In addition to updating the packages as needed so that the dependency
requirements are made, this command will ensure that this package is active
in the system (without requiring the traditional
<strong class="command">python setup.py install</strong>).</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://peak.telecommunity.com/DevCenter/setuptools#declaring-dependencies">Declaring Dependencies</a></p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#runtime-configuration">Runtime Configuration</a><ul>
<li><a class="reference internal" href="#getting-information-from-configuration-files">Getting Information From Configuration Files</a><ul>
<li><a class="reference internal" href="#evaluating-non-string-data-in-configuration-files">Evaluating Non-string Data in Configuration Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#production-configuration-files">Production Configuration Files</a><ul>
<li><a class="reference internal" href="#generating-the-production-configuration">Generating the Production Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#environment">Environment</a></li>
<li><a class="reference internal" href="#url-configuration">URL Configuration</a><ul>
<li><a class="reference internal" href="#adding-a-route-to-match">Adding a route to match <code class="docutils literal"><span class="pre">/</span></code></a></li>
<li><a class="reference internal" href="#generating-urls">Generating URLs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#middleware">Middleware</a><ul>
<li><a class="reference internal" href="#adding-custom-middleware">Adding custom middleware</a></li>
<li><a class="reference internal" href="#what-is-full-stack">What is full_stack?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-setup">Application Setup</a><ul>
<li><a class="reference internal" href="#setting-up-a-new-application">Setting Up a New Application</a></li>
<li><a class="reference internal" href="#configuring-the-package">Configuring the Package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="advanced_models.html"
                        title="previous chapter">Advanced Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="logging.html"
                        title="next chapter">Logging</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="logging.html" title="Logging"
             >next</a> |</li>
        <li class="right" >
          <a href="advanced_models.html" title="Advanced Models"
             >previous</a> |</li>
    	<li><a href="index.html">Pylons Framework 1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2008-2011, Ben Bangert, James Gardner, Philip Jenvey.
      Last updated on Jun 10, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>