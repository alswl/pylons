<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quickwiki tutorial &mdash; Pylons Framework 1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Pylons Framework 1.1 documentation" href="../index.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pylons.ico"/>

  </head>
  <body role="document">







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pylonsfw-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    	<li><a href="../index.html">Pylons Framework 1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="quickwiki-tutorial">
<span id="id1"></span><h1>Quickwiki tutorial<a class="headerlink" href="#quickwiki-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>If you haven&#8217;t done so already, please first read the <a class="reference internal" href="../gettingstarted.html#getting-started"><span class="std std-ref">快速入门</span></a> guide.</p>
<p>In this tutorial we are going to create a working wiki from scratch using Pylons 1.0 and <a class="reference external" href="http://www.sqlalchemy.org">SQLAlchemy</a>. Our wiki will allow visitors to add, edit or delete formatted wiki pages.</p>
</div>
<div class="section" id="starting-at-the-end">
<h2>Starting at the End<a class="headerlink" href="#starting-at-the-end" title="Permalink to this headline">¶</a></h2>
<p>Pylons is designed to be easy for everyone, not just developers, so let&#8217;s start by downloading and installing the finished QuickWiki in exactly the same way that end users of QuickWiki might do. Once we have explored its features we will set about writing it from scratch.</p>
<p>After you have <a class="reference internal" href="../gettingstarted.html#installing-pylons"><span class="std std-ref">installed Pylons</span></a>, install the QuickWiki project:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>easy_install <span class="nv">QuickWiki</span><span class="o">==</span>0.1.8
<span class="nv">$ </span>paster make-config QuickWiki test.ini
</pre></div>
</div>
<p>Next, ensure that the <code class="docutils literal"><span class="pre">sqlalchemy.url</span></code> variable in the <code class="docutils literal"><span class="pre">[app:main]</span></code> section of the configuration file (<code class="docutils literal"><span class="pre">development.ini</span></code>) specifies a value that is suitable for your setup. The data source name points to the database you wish to use.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default <code class="docutils literal"><span class="pre">sqlite:///%(here)s/quickwiki.db</span></code> uses a (file-based) SQLite database named <code class="docutils literal"><span class="pre">quickwiki.db</span></code> in the ini&#8217;s top-level directory. This SQLite database will be created for you when running the <strong class="command">paster setup-app</strong> command below, but you could also use MySQL, Oracle or PostgreSQL. Firebird and MS-SQL may also work. See the <a class="reference external" href="http://www.sqlalchemy.org/docs/05/dbengine.html#create-engine-url-arguments">SQLAlchemy documentation</a> for more information on how to connect to different databases. SQLite for example requires additional forward slashes in its URI, where the client/server databases should only use two. You will also need to make sure you have the appropriate Python driver for the database you wish to use. If you&#8217;re using Python 2.5, a version of the <a class="reference external" href="http://www.initd.org/tracker/pysqlite/wiki/pysqlite">pysqlite adapter</a> is already included, so you can jump right in with the tutorial. You may need to get <a class="reference external" href="http://www.sqlite.org/download.html">SQLite itself</a>.</p>
</div>
<p>Finally create the database tables and serve the finished application:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster setup-app test.ini
<span class="nv">$ </span>paster serve test.ini
</pre></div>
</div>
<p>That&#8217;s it! Now you can visit <a class="reference external" href="http://127.0.0.1:5000">http://127.0.0.1:5000</a> and experiment with the finished Wiki.</p>
<p>When you&#8217;ve finished, stop the server with <code class="kbd docutils literal"><span class="pre">Control-C</span></code> so we can start developing our own version.</p>
<p>If you are interested in looking at the latest version of the QuickWiki source code it can be browsed online at <a class="reference external" href="http://bitbucket.org/bbangert/quickwiki/src/">http://bitbucket.org/bbangert/quickwiki/src/</a> or can be checked out using <a class="reference external" href="http://www.selenic.com/mercurial/">Mercurial</a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>hg clone http://bitbucket.org/bbangert/quickwiki
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To run the QuickWiki checked out from the repository, you&#8217;ll need to first run <strong class="command">python setup.py develop</strong> from the project&#8217;s root directory. This will install its dependencies and generate <a class="reference external" href="http://peak.telecommunity.com/DevCenter/PythonEggs">Python Egg</a> metadata in a <code class="file docutils literal"><span class="pre">QuickWiki.egg-info</span></code> directory. The latter is required for the <strong class="command">paster</strong> command (among other things) .</p>
<div class="last highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>QuickWiki
<span class="nv">$ </span>python setup.py develop
</pre></div>
</div>
</div>
</div>
<div class="section" id="developing-quickwiki">
<h2>Developing QuickWiki<a class="headerlink" href="#developing-quickwiki" title="Permalink to this headline">¶</a></h2>
<p>If you skipped the &#8220;Starting at the End&#8221; section you will need to assure yourself that you have Pylons installed. See the <a class="reference internal" href="../gettingstarted.html#getting-started"><span class="std std-ref">快速入门</span></a>.</p>
<p>Then create your project:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster create -t pylons QuickWiki
</pre></div>
</div>
<p>When prompted for which templating engine to use, simply hit enter for the default (Mako). When prompted for SQLAlchemy configuration, enter <code class="docutils literal"><span class="pre">True</span></code>.</p>
<p>Now let&#8217;s start the server and see what we have:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>QuickWiki
<span class="nv">$ </span>paster serve --reload development.ini
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We have started <strong class="command">paster serve</strong> with the <code class="xref std std-option docutils literal"><span class="pre">--reload</span></code> option. This means any changes that we make to code will cause the server to restart (if necessary); your changes are immediately reflected on the live site.</p>
</div>
<p>Visit <a class="reference external" href="http://127.0.0.1:5000">http://127.0.0.1:5000</a> where you will see the introduction page. Now delete the file <code class="file docutils literal"><span class="pre">public/index.html</span></code> so we can see the front page of the wiki instead of this welcome page. If you now refresh the page, the Pylons built-in error document support will kick in and display an <code class="docutils literal"><span class="pre">Error</span> <span class="pre">404</span></code> page, indicating the file could not be found. We&#8217;ll setup a controller to handle this location later.</p>
</div>
<div class="section" id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Permalink to this headline">¶</a></h2>
<p>Pylons uses a Model-View-Controller architecture; we&#8217;ll start by creating the model. We could use any system we like for the model, including <a class="reference external" href="http://www.sqlalchemy.org">SQLAlchemy</a> or <a class="reference external" href="http://www.sqlobject.org">SQLObject</a>. Optional SQLAlchemy integration is provided for new Pylons projects, which we enabled when creating the project, and thus we&#8217;ll be using SQLAlchemy for the QuickWiki.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="http://www.sqlalchemy.org">SQLAlchemy</a> is a powerful Python SQL toolkit and Object Relational Mapper (ORM) that is widely used by the Python community.</p>
</div>
<p>SQLAlchemy provides a full suite of well known enterprise-level persistence patterns, designed for efficient and high-performance database access, adapted into a simple and Pythonic domain language. It has full and detailed documentation available on the SQLAlchemy website: <a class="reference external" href="http://sqlalchemy.org/docs/">http://sqlalchemy.org/docs/</a>.</p>
<p>The most basic way of using SQLAlchemy is with explicit sessions where you create <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> objects as needed.</p>
<p>Pylons applications typically employ a slightly more sophisticated setup, using SQLAlchemy&#8217;s &#8220;contextual&#8221; thread-local sessions created via the <code class="xref py py-meth docutils literal"><span class="pre">sqlalchemy.orm.scoped_session()</span></code> function. With this configuration, the application can use a single <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> instance per web request, avoiding the need to pass it around explicitly. Instantiating a new scoped <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> will actually find an existing one in the current thread if available. Pylons has setup a <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> for us in the <code class="file docutils literal"><span class="pre">model/meta.py</span></code> file. For further details, refer to the <a class="reference external" href="http://www.sqlalchemy.org/docs/05/session.html#contextual-thread-local-sessions">SQLAlchemy documentation on the Session</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important to recognize the difference between SQLAlchemy&#8217;s (or possibly another DB abstraction layer&#8217;s) <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> object and Pylons&#8217; standard <em class="dfn">session</em> (with a lowercase &#8216;s&#8217;) for web requests. See <code class="xref py py-mod docutils literal"><span class="pre">beaker</span></code> for more on the latter. It is customary to reference the database session by <code class="xref py py-class docutils literal"><span class="pre">model.Session</span></code> or (more recently) <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> outside of model classes.</p>
</div>
<p>The <code class="file docutils literal"><span class="pre">model/__init__.py</span></code> file starts out rather bare-bones. It initializes the SQLAlchemy database engine, and imports the Session object.</p>
<p>At the top, add the following imports:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">orm</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">UnicodeText</span>
<span class="kn">from</span> <span class="nn">quickwiki.model.meta</span> <span class="k">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">Base</span>
</pre></div>
</div>
<p>Then add the following to the end of the <code class="file docutils literal"><span class="pre">model/__init__.py</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;pages&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="s">u&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We&#8217;ve defined a table called <code class="docutils literal"><span class="pre">pages</span></code> which has two columns: <code class="docutils literal"><span class="pre">title</span></code> (the primary key), a Unicode VARCHAR of 40 characters, and <code class="docutils literal"><span class="pre">content</span></code> a Unicode TEXT column of variable sized length.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A primary key is a unique ID for each row in a database table. In the example above we are using the page title as a natural primary key. Some prefer to integer primary keys for all tables, so-called surrogate primary keys. The author of this tutorial uses both methods in his own code and is not advocating one method over the other, what&#8217;s important is to choose the best database structure for your application. See the Pylons Cookbook for <a class="reference external" href="http://wiki.pylonshq.com/display/pylonscookbook/Relational+databases+for+people+in+a+hurry">a quick general overview of relational databases</a> if you&#8217;re not familiar with these concepts.</p>
</div>
<p>A core philosophy of ORMs is that tables and domain classes are different beasts. So next we&#8217;ll create the Python class that represents the pages of our wiki, and map these domain objects to rows in the <code class="docutils literal"><span class="pre">pages</span></code> table via the <a class="reference external" href="http://www.sqlalchemy.org/docs/orm/mapping_api.html#sqlalchemy.orm.mapper" title="(in SQLAlchemy v1.0)"><code class="xref py py-func docutils literal"><span class="pre">sqlalchemy.orm.mapper()</span></code></a> function. In a more complex application, you could break out model classes into separate <code class="docutils literal"><span class="pre">.py</span></code> files in your <code class="file docutils literal"><span class="pre">model</span></code> directory, but for sake of simplicity in this case, we&#8217;ll just stick to <code class="file docutils literal"><span class="pre">__init__.py</span></code>.</p>
<p>Add this to the bottom of <code class="docutils literal"><span class="pre">model/__init__.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__unicode__</span>

<span class="n">orm</span><span class="o">.</span><span class="n">mapper</span><span class="p">(</span><span class="n">Page</span><span class="p">,</span> <span class="n">pages_table</span><span class="p">)</span>
</pre></div>
</div>
<p>A <code class="xref py py-class docutils literal"><span class="pre">Page</span></code> object represents a row in the <code class="docutils literal"><span class="pre">pages</span></code> table, so <code class="docutils literal"><span class="pre">self.title</span></code> and <code class="docutils literal"><span class="pre">self.content</span></code> will be the values of the <code class="docutils literal"><span class="pre">title</span></code> and <code class="docutils literal"><span class="pre">content</span></code> columns.</p>
<p>Looking ahead, our wiki could use a way of marking up the <code class="docutils literal"><span class="pre">content</span></code> field into HTML. Also, any &#8216;WikiWords&#8217; (words made by joining together two or more capitalized words) should be converted to hyperlinks to wiki pages.</p>
<p>We can use Python&#8217;s <a class="reference external" href="http://docutils.sourceforge.net/">docutils</a> library to allow marking up <code class="docutils literal"><span class="pre">content</span></code> as <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>. So next we&#8217;ll add a method to our <code class="xref py py-class docutils literal"><span class="pre">Page</span></code> class that formats <code class="docutils literal"><span class="pre">content</span></code> as HTML and converts the WikiWords to hyperlinks. Add the following at the top of the <code class="file docutils literal"><span class="pre">model/__init__.py</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sets</span>
<span class="kn">from</span> <span class="nn">docutils.core</span> <span class="kn">import</span> <span class="n">publish_parts</span>

<span class="kn">from</span> <span class="nn">pylons</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">quickwiki.lib.helpers</span> <span class="kn">import</span> <span class="n">link_to</span>
<span class="kn">from</span> <span class="nn">quickwiki.model</span> <span class="kn">import</span> <span class="n">meta</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># disable docutils security hazards:</span>
<span class="c"># http://docutils.sourceforge.net/docs/howto/security.html</span>
<span class="n">SAFE_DOCUTILS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">file_insertion_enabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">raw_enabled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">wikiwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b([A-Z]\w+[A-Z]+\w+)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
</pre></div>
</div>
<p>then add a <code class="xref py py-meth docutils literal"><span class="pre">get_wiki_content()</span></code> method to the <code class="xref py py-class docutils literal"><span class="pre">Page</span></code> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>

    <span class="k">def</span> <span class="nf">get_wiki_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert reStructuredText content to HTML for display, and</span>
<span class="sd">        create links for WikiWords</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s">&#39;html&#39;</span><span class="p">,</span>
                                <span class="n">settings_overrides</span><span class="o">=</span><span class="n">SAFE_DOCUTILS</span><span class="p">)[</span><span class="s">&#39;html_body&#39;</span><span class="p">]</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">wikiwords</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">title_url</span> <span class="o">=</span> <span class="n">url</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;show&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">link_to</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">title_url</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">content</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__unicode__</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal"><span class="pre">Set</span></code> object provides us with only unique WikiWord names, so we don&#8217;t try replacing them more than once (a &#8220;wikiword&#8221; is of course defined by the regular expression set globally).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pylons uses a <strong>Model View Controller</strong> architecture and so the formatting of objects into HTML should properly be handled in the View, i.e. in a template. However in this example, converting <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> into HTML in a template is inappropriate so we are treating the HTML representation of the content as part of the model. It also gives us the chance to demonstrate that SQLAlchemy domain classes are real Python classes that can have their own methods.</p>
</div>
<p>The <code class="xref py py-func docutils literal"><span class="pre">link_to()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">url()</span></code> functions referenced in the controller code are respectively: a helper imported from the <a class="reference external" href="http://sluggo.scrapping.cc/python/WebHelpers/modules/html/__init__.html#module-webhelpers.html" title="(in WebHelpers v1.3)"><code class="xref py py-mod docutils literal"><span class="pre">webhelpers.html</span></code></a> module indirectly via <code class="file docutils literal"><span class="pre">lib/helpers.py</span></code>, and a utility function imported directly from the <code class="xref py py-mod docutils literal"><span class="pre">pylons</span></code> module. They are utilities for creating links to specific controller actions. In this case we have decided that all WikiWords should link to the <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> action of the <code class="docutils literal"><span class="pre">pages</span></code> controller which we&#8217;ll create later. However, we need to ensure that the <code class="xref py py-func docutils literal"><span class="pre">link_to()</span></code> function is made available as a helper by adding an import statement to <code class="file docutils literal"><span class="pre">lib/helpers.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;Helper functions</span>

<span class="sd">Consists of functions to typically be used within templates, but also</span>
<span class="sd">available to Controllers. This module is available to templates as &#39;h&#39;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">webhelpers.html.tags</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Since we have used docutils and SQLAlchemy, both third party packages, we need to edit our <code class="file docutils literal"><span class="pre">setup.py</span></code> file so that anyone installing QuickWiki with <a class="reference external" href="http://peak.telecommunity.com/DevCenter/EasyInstall">Easy Install</a> will automatically have these dependencies installed too. Edit your <code class="file docutils literal"><span class="pre">setup.py</span></code> in your project root directory and add a docutils entry to the <code class="docutils literal"><span class="pre">install_requires</span></code> line (there will already be one for SQLAlchemy):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
    <span class="s">&quot;Pylons&gt;=0.9.7&quot;</span><span class="p">,</span>
    <span class="s">&quot;SQLAlchemy&gt;=0.5&quot;</span><span class="p">,</span>
    <span class="s">&quot;docutils==0.4&quot;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>
</div>
<p>While we are we are making changes to <code class="file docutils literal"><span class="pre">setup.py</span></code> we might want to complete some of the other sections too. Set the version number to 0.1.6 and add a description and URL which will be used on PyPi when we release it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">version</span><span class="o">=</span><span class="s">&#39;0.1.6&#39;</span><span class="p">,</span>
<span class="n">description</span><span class="o">=</span><span class="s">&#39;QuickWiki - Pylons 0.9.7 Tutorial application&#39;</span><span class="p">,</span>
<span class="n">url</span><span class="o">=</span><span class="s">&#39;http://docs.pylonshq.com/tutorials/quickwiki_tutorial.html&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>We might also want to make a full release rather than a development release in which case we would remove the following lines from <code class="file docutils literal"><span class="pre">setup.cfg</span></code>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[egg_info]</span>
<span class="na">tag_build</span> <span class="o">=</span> <span class="s">dev</span>
<span class="na">tag_svn_revision</span> <span class="o">=</span> <span class="s">true</span>
</pre></div>
</div>
<p>To test the automatic installation of the dependencies, run the following command which will also install docutils and SQLAlchemy if you don&#8217;t already have them:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python setup.py develop
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The command <strong class="command">python setup.py develop</strong> installs your application in a special mode so that it behaves exactly as if it had been installed as an egg file by an end user. This is really useful when you are developing an application because it saves you having to create an egg and install it every time you want to test a change.</p>
</div>
</div>
<div class="section" id="application-setup">
<h2>Application Setup<a class="headerlink" href="#application-setup" title="Permalink to this headline">¶</a></h2>
<p>Edit <code class="file docutils literal"><span class="pre">websetup.py</span></code>, used by the <strong class="command">paster setup-app</strong> command, to look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;Setup the QuickWiki application&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">quickwiki</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">quickwiki.config.environment</span> <span class="kn">import</span> <span class="n">load_environment</span>
<span class="kn">from</span> <span class="nn">quickwiki.model</span> <span class="kn">import</span> <span class="n">meta</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup_app</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="nb">vars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Place any commands to setup quickwiki here&quot;&quot;&quot;</span>
    <span class="n">load_environment</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">global_conf</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">local_conf</span><span class="p">)</span>

    <span class="c"># Create the tables if they don&#39;t already exist</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Creating tables...&quot;</span><span class="p">)</span>
    <span class="n">meta</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Successfully set up.&quot;</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Adding front page data...&quot;</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Page</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">u&#39;FrontPage&#39;</span><span class="p">,</span>
                      <span class="n">content</span><span class="o">=</span><span class="s">u&#39;**Welcome** to the QuickWiki front page!&#39;</span><span class="p">)</span>
    <span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Successfully set up.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can see that <code class="file docutils literal"><span class="pre">config/environment.py</span></code>&#8216;s <code class="xref py py-func docutils literal"><span class="pre">load_environment()</span></code> function is called (which calls <code class="file docutils literal"><span class="pre">model/__init__.py</span></code>&#8216;s <code class="xref py py-func docutils literal"><span class="pre">init_model()</span></code> function), so our engine is ready for binding and we can import the model. A SQLAlchemy <code class="xref py py-class docutils literal"><span class="pre">MetaData</span></code> object &#8211; which provides some utility methods for operating on database schema &#8211; usually needs to be connected to an engine, so the line</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">meta</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">engine</span>
</pre></div>
</div>
<p>does exactly that and then</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">checkfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>uses the connection we&#8217;ve just set up and, creates the table(s) we&#8217;ve defined ... if they don&#8217;t already exist. After the tables are created, the other lines add some data for the simple front page to our wiki.</p>
<p>By default, SQLAlchemy specifies <code class="docutils literal"><span class="pre">autocommit=False</span></code> when creating the <code class="xref py py-class docutils literal"><span class="pre">Session</span></code>, which means that operations will be wrapped in a transaction and <code class="xref py py-func docutils literal"><span class="pre">commit()</span></code>&#8216;ed atomically (unless your DB doesn&#8217;t support transactions, like MySQL&#8217;s default MyISAM tables &#8211; but that&#8217;s beyond the scope of this tutorial).</p>
<p>The database SQLAlchemy will use is specified in the <code class="docutils literal"><span class="pre">ini</span></code> file, under the <code class="docutils literal"><span class="pre">[app:main]</span></code> section, as <code class="docutils literal"><span class="pre">sqlalchemy.url</span></code>. We&#8217;ll customize the <code class="docutils literal"><span class="pre">sqlalchemy.url</span></code> value to point to a SQLite database named <code class="file docutils literal"><span class="pre">quickwiki.db</span></code> that will reside in your project&#8217;s root directory. Edit the <code class="file docutils literal"><span class="pre">development.ini</span></code> file in the root directory of your project:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you&#8217;ve decided to use a different database other than SQLite, see the SQLAlchemy note in the <a class="reference internal" href="#starting-at-the-end">Starting at the End</a> section for information on supported database URIs.</p>
</div>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[app:main]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:QuickWiki</span>
<span class="c1">#...</span>
<span class="c1"># Specify the database for SQLAlchemy to use.</span>
<span class="c1"># SQLAlchemy database URL</span>
<span class="na">sqlalchemy.url</span> <span class="o">=</span> <span class="s">sqlite:///%(here)s/quickwiki.db</span>
</pre></div>
</div>
<p>You can now run the <strong class="command">paster setup-app</strong> command to setup your tables in the same way an end user would, remembering to drop and recreate the database if the version tested earlier has already created the tables:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster setup-app development.ini
</pre></div>
</div>
<p>You should see the SQL sent to the database as the default <code class="file docutils literal"><span class="pre">development.ini</span></code> is setup to log SQLAlchemy&#8217;s SQL statements.</p>
<p>At this stage you will need to ensure you have the appropriate Python database drivers for the database you chose, otherwise you might find SQLAlchemy complains it can&#8217;t get the DBAPI module for the dialect it needs.</p>
<p>You should also edit <code class="file docutils literal"><span class="pre">quickwiki/config/deployment.ini_tmpl</span></code> so that when users run <strong class="command">paster make-config</strong> the configuration file that is produced for them will also use <code class="file docutils literal"><span class="pre">quickwiki.db</span></code>. In the <code class="docutils literal"><span class="pre">[app:main]</span></code> section:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="c1"># Specify the database for SQLAlchemy to use.</span>
<span class="na">sqlalchemy.url</span> <span class="o">=</span> <span class="s">sqlite:///%(here)s/quickwiki.db</span>
</pre></div>
</div>
</div>
<div class="section" id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pylons uses the <a class="reference external" href="http://www.makotemplates.org">Mako templating engine</a> by default, although as is the case with most aspects of Pylons, you are free to deviate from the default if you prefer.</p>
</div>
<p>In our project we will make use of the <a class="reference external" href="http://www.makotemplates.org/docs/inheritance.html">Mako inheritance feature</a>. Add the main page template in <code class="file docutils literal"><span class="pre">templates/base.mako</span></code>:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">  &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>QuickWiki<span class="nt">&lt;/title&gt;</span>
    <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">stylesheet_link</span><span class="p">(</span><span class="s">&#39;/quick.css&#39;</span><span class="p">)</span><span class="cp">}</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="cp">}</span><span class="nt">&lt;/h1&gt;</span>
      <span class="cp">${</span><span class="nb">next</span><span class="o">.</span><span class="n">body</span><span class="p">()</span><span class="cp">}</span>\
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
        Return to the <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;FrontPage&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;FrontPage&#39;</span><span class="p">))</span><span class="cp">}</span>
        | <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;Edit &#39;</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">))</span><span class="cp">}</span>
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>We&#8217;ll setup all our other templates to inherit from this one: they will be automatically inserted into the <code class="docutils literal"><span class="pre">${next.body()}</span></code> line. Thus the whole page will be returned when we call the <code class="xref py py-func docutils literal"><span class="pre">render()</span></code> global from our controller. This lets us easily apply a consistent theme to all our templates.</p>
<p>If you are interested in learning some of the features of Mako templates have a look at the comprehensive <a class="reference external" href="http://www.makotemplates.org/docs/">Mako Documentation</a>. For now we just need to understand that <code class="xref py py-func docutils literal"><span class="pre">next.body()</span></code> is replaced with the child template and that anything within <code class="docutils literal"><span class="pre">${...}</span></code> brackets is executed and replaced with the result. By default, the replacement content is HTML-escaped in order to meet modern standards of basic protection from accidentally making the app vulnerable to XSS exploit.</p>
<p>This <code class="file docutils literal"><span class="pre">base.mako</span></code> also makes use of various helper functions attached to the <code class="docutils literal"><span class="pre">h</span></code> object. These are described in the <a class="reference external" href="http://pylonshq.com/WebHelpers/module-index.html">WebHelpers documentation</a>. We need to add some helpers to the <code class="docutils literal"><span class="pre">h</span></code> by importing them in the <code class="file docutils literal"><span class="pre">lib/helpers.py</span></code> module (some are for later use):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;Helper functions</span>

<span class="sd">Consists of functions to typically be used within templates, but also</span>
<span class="sd">available to Controllers. This module is available to templates as &#39;h&#39;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">webhelpers.html</span> <span class="kn">import</span> <span class="n">literal</span>
<span class="kn">from</span> <span class="nn">webhelpers.html.tags</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">webhelpers.html.secure_form</span> <span class="kn">import</span> <span class="n">secure_form</span>
</pre></div>
</div>
<p>Note that the <code class="file docutils literal"><span class="pre">helpers</span></code> module is available to templates as &#8216;h&#8217;, this is a good place to import or define directly any convenience functions that you want to make available to all templates.</p>
</div>
<div class="section" id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h2>
<p>Before we can add the actions we want to be able to route the requests to them correctly. Edit <code class="file docutils literal"><span class="pre">config/routing.py</span></code> and adjust the &#8216;Custom Routes&#8217; section to look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># CUSTOM ROUTES HERE</span>

<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;show&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;FrontPage&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;pages&#39;</span><span class="p">,</span> <span class="s">&#39;/pages&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;show_page&#39;</span><span class="p">,</span> <span class="s">&#39;/pages/show/{title}&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s">&#39;show&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="s">&#39;/pages/edit/{title}&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s">&#39;edit&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;save_page&#39;</span><span class="p">,</span> <span class="s">&#39;/pages/save/{title}&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s">&#39;save&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;POST&#39;</span><span class="p">))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;delete_page&#39;</span><span class="p">,</span> <span class="s">&#39;/pages/delete&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s">&#39;delete&#39;</span><span class="p">)</span>

<span class="c"># A bonus example - the specified defaults allow visiting</span>
<span class="c"># example.com/FrontPage to view the page titled &#39;FrontPage&#39;:</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{title}&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&#39;pages&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;show&#39;</span><span class="p">)</span>

<span class="k">return</span> <span class="nb">map</span>
</pre></div>
</div>
<p>Note that the default route has been replaced. This tells Pylons to route the root URL <code class="docutils literal"><span class="pre">/</span></code> to the <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> method of the <code class="xref py py-class docutils literal"><span class="pre">PageController</span></code> class in <code class="file docutils literal"><span class="pre">controllers/pages.py</span></code> and specify the <code class="docutils literal"><span class="pre">title</span></code> argument as <code class="docutils literal"><span class="pre">'FrontPage'</span></code>. It also says that any URL of the form <code class="docutils literal"><span class="pre">/SomePage</span></code> should be routed to the same method but the <code class="docutils literal"><span class="pre">title</span></code> argument will contain the value of the first part of the URL, in this case <code class="docutils literal"><span class="pre">SomePage</span></code>. Any other URLs that can&#8217;t be matched by these maps are routed to the error controller as usual where they will result in a 404 error page being displayed.</p>
<p>One of the main benefits of using the Routes system is that you can also create URLs automatically, simply by specifying the routing arguments. For example if I want the URL for the page <code class="docutils literal"><span class="pre">FrontPage</span></code> I can create it with this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;FrontPage&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Although the URL would be fairly simple to create manually, with complicated URLs this approach is much quicker. It also has the significant advantage that if you ever deploy your Pylons application at a URL other than <code class="docutils literal"><span class="pre">/</span></code>, all the URLs will be automatically adjusted for the new path without you needing to make any manual modifications. This flexibility is a real advantage.</p>
<p>Full information on the powerful things you can do to route requests to controllers and actions can be found in the <a class="reference external" href="http://routes.groovie.org/manual.html">Routes manual</a>.</p>
</div>
<div class="section" id="controllers">
<h2>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h2>
<p>Quick Recap: We&#8217;ve setup the model, configured the application, added the routes and setup the base template in <code class="file docutils literal"><span class="pre">base.mako</span></code>, now we need to write the application logic and we do this with controllers. In your project&#8217;s root directory, add a controller called <code class="docutils literal"><span class="pre">pages</span></code> to your project with this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster controller pages
</pre></div>
</div>
<p>If you are using Subversion, this will automatically be detected and the new controller and tests will be automatically added to your subversion repository.</p>
<p>We are going to need the following actions:</p>
<p><code class="docutils literal"><span class="pre">show(self,</span> <span class="pre">title)</span></code>
displays a page based on the title</p>
<p><code class="docutils literal"><span class="pre">edit(self,</span> <span class="pre">title)</span></code>
displays a from for editing the page <code class="docutils literal"><span class="pre">title</span></code></p>
<p><code class="docutils literal"><span class="pre">save(self,</span> <span class="pre">title)</span></code>
save the page <code class="docutils literal"><span class="pre">title</span></code> and show it with a saved message</p>
<p><code class="docutils literal"><span class="pre">index(self)</span></code>
lists all of the titles of the pages in the database</p>
<p><code class="docutils literal"><span class="pre">delete(self,</span> <span class="pre">title)</span></code>
deletes a page</p>
<div class="section" id="show">
<h3><code class="xref py py-meth docutils literal"><span class="pre">show()</span></code><a class="headerlink" href="#show" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s get to work on the new controller in <code class="file docutils literal"><span class="pre">controllers/pages.py</span></code>. First we&#8217;ll import the <code class="xref py py-class docutils literal"><span class="pre">Page</span></code> class from our <code class="xref py py-mod docutils literal"><span class="pre">model</span></code>, and the <code class="xref py py-class docutils literal"><span class="pre">Session</span></code> class from the <code class="xref py py-mod docutils literal"><span class="pre">model.meta</span></code> module. We&#8217;ll also import the <code class="docutils literal"><span class="pre">wikiwords</span></code> regular expression object, which we&#8217;ll use in the <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> method. Add this line with the imports at the top of the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">quickwiki.model</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">wikiwords</span>
<span class="kn">from</span> <span class="nn">quickwiki.model.meta</span> <span class="kn">import</span> <span class="n">Session</span>
</pre></div>
</div>
<p>Next we&#8217;ll add the convenience method <code class="xref py py-meth docutils literal"><span class="pre">__before__()</span></code> to the <code class="xref py py-class docutils literal"><span class="pre">PagesController</span></code>, which is a special method Pylons always calls before calling the actual action method. We&#8217;ll have <code class="xref py py-meth docutils literal"><span class="pre">__before__()</span></code> obtain and make available the relevant query object from the database, ready to be queried. Our other action methods will need this query object, so we might as well create it one place.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span><span class="p">(</span><span class="n">BaseController</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__before__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_q</span> <span class="o">=</span> <span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can query the database using the query expression language provided by SQLAlchemy.
Add the following <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> method to <code class="xref py py-class docutils literal"><span class="pre">PagesController</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">page</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_wiki_content</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s">&#39;/pages/show.mako&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s">&#39;/pages/new.mako&#39;</span><span class="p">)</span>
    <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a template called <code class="file docutils literal"><span class="pre">templates/pages/show.mako</span></code> that looks like this:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;%</span><span class="nb">inherit</span> <span class="na">file=</span><span class="s">&quot;/base.mako&quot;</span><span class="cp">/&gt;</span>\

<span class="cp">&lt;%</span><span class="nb">def</span> <span class="na">name=</span><span class="s">&quot;header()&quot;</span><span class="cp">&gt;${</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="cp">}&lt;/%</span><span class="nb">def</span><span class="cp">&gt;</span>

<span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">literal</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="cp">}</span>
</pre></div>
</div>
<p>This template simply displays the page title and content.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pylons automatically assigns all the action parameters to the Pylons context object <code class="docutils literal"><span class="pre">c</span></code> so that you don&#8217;t have to assign them yourself. In this case, the value of <code class="docutils literal"><span class="pre">title</span></code> will be automatically assigned to <code class="docutils literal"><span class="pre">c.title</span></code> so that it can be used in the templates. We assign <code class="docutils literal"><span class="pre">c.content</span></code> manually in the controller.</p>
</div>
<p>We also need a template for pages that don&#8217;t already exist. The template needs to display a message and link to the <code class="xref py py-meth docutils literal"><span class="pre">edit()</span></code> action so that they can be created. Add a template called <code class="file docutils literal"><span class="pre">templates/new.mako</span></code> that looks like this:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;%</span><span class="nb">inherit</span> <span class="na">file=</span><span class="s">&quot;/base.mako&quot;</span><span class="cp">/&gt;</span>\

<span class="cp">&lt;%</span><span class="nb">def</span> <span class="na">name=</span><span class="s">&quot;header()&quot;</span><span class="cp">&gt;${</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="cp">}&lt;/%</span><span class="nb">def</span><span class="cp">&gt;</span>

<span class="nt">&lt;p&gt;</span>This page doesn&#39;t exist yet.
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">${</span><span class="n">url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="cp">}</span><span class="s">&quot;</span><span class="nt">&gt;</span>Create the page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<p>At this point we can test our QuickWiki to see how it looks. If you don&#8217;t already have a server running, start it now with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>paster serve --reload development.ini
</pre></div>
</div>
<p>We can spruce up the appearance of page a little by adding the stylesheet we linked to in the <code class="file docutils literal"><span class="pre">templates/base.mako</span></code> file earlier. Add the file <code class="file docutils literal"><span class="pre">public/quick.css</span></code> with the following content and refresh the page to reveal a better looking wiki:</p>
<div class="highlight-css"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="m">#888</span><span class="p">;</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">25px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">div</span><span class="nc">.content</span> <span class="p">{</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="m">#d3e0ea</span><span class="p">;</span>
  <span class="k">border</span><span class="o">:</span> <span class="m">5px</span> <span class="k">solid</span> <span class="m">#333</span><span class="p">;</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span> <span class="m">25px</span> <span class="m">25px</span> <span class="m">25px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span><span class="nc">.main</span> <span class="p">{</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span><span class="nc">.footer</span><span class="p">{</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="k">padding-top</span><span class="o">:</span> <span class="m">8px</span><span class="p">;</span>
  <span class="k">border-top</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#000</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">a</span> <span class="p">{</span>
  <span class="k">text-decoration</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="k">text-decoration</span><span class="o">:</span> <span class="k">underline</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When you run the example you will notice that the word <code class="docutils literal"><span class="pre">QuickWiki</span></code> has been turned into a hyperlink by the <code class="xref py py-func docutils literal"><span class="pre">get_wiki_content()</span></code> method we added to our <code class="xref py py-class docutils literal"><span class="pre">Page</span></code> domain object earlier. You can click the link and will see an example of the new page screen from the <code class="file docutils literal"><span class="pre">new.mako</span></code> template. If you follow the <code class="docutils literal"><span class="pre">Create</span> <span class="pre">the</span> <span class="pre">page</span></code> link you will see the Pylons automatic error handler kick in to tell you <code class="docutils literal"><span class="pre">Action</span> <span class="pre">edit</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">implemented</span></code>. Well, we better write it next, but before we do, have a play with the <a class="reference internal" href="../debugging.html#interactive-debugging"><span class="std std-ref">Interactive Debugging</span></a>, try clicking on the <code class="docutils literal"><span class="pre">+</span></code> or <code class="docutils literal"><span class="pre">&gt;&gt;</span></code> arrows and you will be able to interactively debug your application. It is a tremendously useful tool.</p>
</div>
<div class="section" id="edit">
<h3><code class="xref py py-meth docutils literal"><span class="pre">edit()</span></code><a class="headerlink" href="#edit" title="Permalink to this headline">¶</a></h3>
<p>To edit the wiki page we need to get the content from the database without changing it to HTML to display it in a simple form for editing. Add the <code class="xref py py-meth docutils literal"><span class="pre">edit()</span></code> action:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">page</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s">&#39;/pages/edit.mako&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and then create the <code class="file docutils literal"><span class="pre">templates/edit.mako</span></code> file:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;%</span><span class="nb">inherit</span> <span class="na">file=</span><span class="s">&quot;/base.mako&quot;</span><span class="cp">/&gt;</span>\

<span class="cp">&lt;%</span><span class="nb">def</span> <span class="na">name=</span><span class="s">&quot;header()&quot;</span><span class="cp">&gt;</span>Editing <span class="cp">${</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="cp">}&lt;/%</span><span class="nb">def</span><span class="cp">&gt;</span>

<span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">secure_form</span><span class="p">(</span><span class="n">url</span><span class="p">(</span><span class="s">&#39;save_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">))</span><span class="cp">}</span>
  <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">textarea</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="cp">}</span> <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
  <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;Save changes&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;commit&#39;</span><span class="p">)</span><span class="cp">}</span>
<span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">end_form</span><span class="p">()</span><span class="cp">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may have noticed that we only set <code class="docutils literal"><span class="pre">c.content</span></code> if the page exists but that it is accessed in <code class="xref py py-func docutils literal"><span class="pre">h.text_area()</span></code> even for pages that don&#8217;t exist and yet it doesn&#8217;t raise an <code class="xref py py-class docutils literal"><span class="pre">AttributeError</span></code>.</p>
</div>
<p>We are making use of the fact that the <code class="docutils literal"><span class="pre">c</span></code> object returns an empty string <code class="docutils literal"><span class="pre">&quot;&quot;</span></code> for any attribute that is accessed which doesn&#8217;t exist. This can be a very useful feature of the <code class="docutils literal"><span class="pre">c</span></code> object, but can catch you on occasions where you don&#8217;t expect this behavior. It can be disabled by setting <code class="docutils literal"><span class="pre">config['pylons.strict_c']</span> <span class="pre">=</span> <span class="pre">True</span></code> in your project&#8217;s <code class="file docutils literal"><span class="pre">config/environment.py</span></code>.</p>
<p>We are making use of the <code class="docutils literal"><span class="pre">h</span></code> object to create our form and field objects. This saves a bit of manual HTML writing. The form submits to the <code class="xref py py-meth docutils literal"><span class="pre">save()</span></code> action to save the new or updated content so let&#8217;s write that next.</p>
</div>
<div class="section" id="save">
<h3><code class="xref py py-meth docutils literal"><span class="pre">save()</span></code><a class="headerlink" href="#save" title="Permalink to this headline">¶</a></h3>
<p>The first thing the <code class="xref py py-meth docutils literal"><span class="pre">save()</span></code> action has to do is to see if the page being saved already exists. If not it creates it with <code class="docutils literal"><span class="pre">page</span> <span class="pre">=</span> <span class="pre">model.Page(title)</span></code>. Next it needs the updated content. In Pylons you can get request parameters from form submissions via <code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code> requests from the appropriately named <code class="docutils literal"><span class="pre">request</span></code> object. For form submissions from <em>only</em> <code class="docutils literal"><span class="pre">GET</span></code> or <code class="docutils literal"><span class="pre">POST</span></code> requests, use <code class="docutils literal"><span class="pre">request.GET</span></code> or <code class="docutils literal"><span class="pre">request.POST</span></code>. Only <code class="docutils literal"><span class="pre">POST</span></code> requests should generate side effects (like changing data), so the save action will only reference <code class="docutils literal"><span class="pre">request.POST</span></code> for the parameters.</p>
<p>Then add the <code class="xref py py-meth docutils literal"><span class="pre">save()</span></code> action:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@authenticate_form</span>
<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c"># In a real application, you should validate and sanitize</span>
    <span class="c"># submitted data throughly! escape is a minimal example here.</span>
    <span class="n">page</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getone</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">))</span>
    <span class="n">Session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="n">Session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">flash</span><span class="p">(</span><span class="s">&#39;Successfully saved </span><span class="si">%s</span><span class="s">!&#39;</span> <span class="o">%</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">redirect_to</span><span class="p">(</span><span class="s">&#39;show_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">request.POST</span></code> is a MultiDict object: an ordered dictionary that may contain multiple values for each key. The MultiDict will always return one value for any existing key via the normal dict accessors <code class="docutils literal"><span class="pre">request.POST[key]</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">request.POST.get()</span></code>. When multiple values are expected, use the <code class="xref py py-meth docutils literal"><span class="pre">request.POST.getall()</span></code> method to return all values in a list. <code class="xref py py-meth docutils literal"><span class="pre">request.POST.getone()</span></code> ensures one value for key was sent, raising a <code class="xref py py-class docutils literal"><span class="pre">KeyError</span></code> when there are 0 or more than 1 values.</p>
</div>
<p>The <code class="xref py py-func docutils literal"><span class="pre">&#64;authenticate_form()</span></code> decorator that appears immediately before the  <code class="xref py py-meth docutils literal"><span class="pre">save()</span></code> action checks the value of the hidden form field placed there by the <code class="xref py py-func docutils literal"><span class="pre">secure_form()</span></code> helper that we used in <code class="file docutils literal"><span class="pre">templates/edit.mako</span></code> to create the form. The hidden form field carries an authorization token for prevention of certain <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross-site request forgery (CSRF)</a> attacks.</p>
<p>Upon a successful save, we want to redirect back to the <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> action and &#8216;flash&#8217; a <code class="docutils literal"><span class="pre">Successfully</span> <span class="pre">saved</span></code> message at the top of the page. &#8216;Flashing&#8217; a status message immediately after an action is a common requirement, and the <cite>WebHelpers</cite> package provides the <code class="xref py py-class docutils literal"><span class="pre">webhelpers.pylonslib.Flash</span></code> class that makes it easy. To utilize it, we&#8217;ll create a flash object at the bottom of our <code class="file docutils literal"><span class="pre">lib/helpers.py</span></code> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webhelpers.pylonslib</span> <span class="kn">import</span> <span class="n">Flash</span> <span class="k">as</span> <span class="n">_Flash</span>

<span class="n">flash</span> <span class="o">=</span> <span class="n">_Flash</span><span class="p">()</span>
</pre></div>
</div>
<p>And import it into our <code class="file docutils literal"><span class="pre">controllers/pages.py</span></code>. Our new <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> method
is escaping the content via Python&#8217;s <code class="xref py py-func docutils literal"><span class="pre">cgi.escape()</span></code> function, so we need to
import that too, and also <code class="xref py py-func docutils literal"><span class="pre">&#64;authenticate_form()</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cgi</span> <span class="kn">import</span> <span class="n">escape</span>

<span class="kn">from</span> <span class="nn">pylons.decorators.secure</span> <span class="kn">import</span> <span class="n">authenticate_form</span>

<span class="kn">from</span> <span class="nn">quickwiki.lib.helpers</span> <span class="kn">import</span> <span class="n">flash</span>
</pre></div>
</div>
<p>And finally utilize the <code class="docutils literal"><span class="pre">flash</span></code> object in our <code class="file docutils literal"><span class="pre">templates/base.mako</span></code> template:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">  &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>QuickWiki<span class="nt">&lt;/title&gt;</span>
    <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">stylesheet_link</span><span class="p">(</span><span class="s">&#39;/quick.css&#39;</span><span class="p">)</span><span class="cp">}</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="cp">}</span><span class="nt">&lt;/h1&gt;</span>

      <span class="cp">&lt;%</span> <span class="n">flashes</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">flash</span><span class="o">.</span><span class="n">pop_messages</span><span class="p">()</span> <span class="cp">%&gt;</span>
      <span class="cp">%</span> <span class="k">if</span> <span class="n">flashes</span><span class="p">:</span>
        <span class="cp">%</span> <span class="k">for</span> <span class="n">flash</span> <span class="ow">in</span> <span class="n">flashes</span><span class="p">:</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;flash&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="n">flash</span><span class="cp">}</span><span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">%</span><span class="k"> endfor</span>
      <span class="cp">%</span><span class="k"> endif</span>

      <span class="cp">${</span><span class="nb">next</span><span class="o">.</span><span class="n">body</span><span class="p">()</span><span class="cp">}</span>\
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
        Return to the <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;FrontPage&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;FrontPage&#39;</span><span class="p">))</span><span class="cp">}</span>
        | <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;Edit &#39;</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">))</span><span class="cp">}</span>
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>And add the following to the <code class="file docutils literal"><span class="pre">public/quick.css</span></code> file:</p>
<div class="highlight-css"><div class="highlight"><pre><span class="nt">div</span><span class="nf">#flash</span> <span class="nc">.message</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">orangered</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">%</span></code> syntax is used for control structures in mako &#8211; conditionals and loops. You must &#8216;close&#8217; them with an &#8216;end&#8217; tag as shown here. At this point we have a fully functioning wiki that lets you create and edit pages and can be installed and deployed by an end user with just a few simple commands.</p>
<p>Visit <a class="reference external" href="http://127.0.0.1:5000">http://127.0.0.1:5000</a> and have a play.</p>
<p>It would be nice to get a title list and to be able to delete pages, so that&#8217;s what we&#8217;ll do next!</p>
</div>
<div class="section" id="index">
<h3><code class="xref py py-meth docutils literal"><span class="pre">index()</span></code><a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h3>
<p>Add the <code class="xref py py-meth docutils literal"><span class="pre">index()</span></code> action:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s">&#39;/pages/index.mako&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-meth docutils literal"><span class="pre">index()</span></code> action simply gets all the pages from the database. Create the <code class="file docutils literal"><span class="pre">templates/index.mako</span></code> file to display the list:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;%</span><span class="nb">inherit</span> <span class="na">file=</span><span class="s">&quot;/base.mako&quot;</span><span class="cp">/&gt;</span>\

<span class="cp">&lt;%</span><span class="nb">def</span> <span class="na">name=</span><span class="s">&quot;header()&quot;</span><span class="cp">&gt;</span>Title List<span class="cp">&lt;/%</span><span class="nb">def</span><span class="cp">&gt;</span>

<span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">secure_form</span><span class="p">(</span><span class="n">url</span><span class="p">(</span><span class="s">&#39;delete_page&#39;</span><span class="p">))</span><span class="cp">}</span>

<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;titles&quot;</span><span class="nt">&gt;</span>
  <span class="cp">%</span> <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">titles</span><span class="p">:</span>
  <span class="nt">&lt;li&gt;</span>
    <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;show_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">))</span><span class="cp">}</span> -
    <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">checkbox</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span><span class="cp">}</span>
  <span class="nt">&lt;/li&gt;</span>
  <span class="cp">%</span><span class="k"> endfor</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="s">&#39;Delete&#39;</span><span class="p">)</span><span class="cp">}</span>

<span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">end_form</span><span class="p">()</span><span class="cp">}</span>
</pre></div>
</div>
<p>This displays a form listing a link to all pages along with a checkbox. When submitted, the selected titles will be sent to a <code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code> action we&#8217;ll create in the next step.</p>
<p>We need to edit <code class="file docutils literal"><span class="pre">templates/base.mako</span></code> to add a link to the title list in the footer, but while we&#8217;re at it, let&#8217;s introduce a Mako function to make the footer a little smarter. Edit <code class="file docutils literal"><span class="pre">base.mako</span></code> like this:</p>
<div class="highlight-html+mako"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="cp">  &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>QuickWiki<span class="nt">&lt;/title&gt;</span>
    <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">stylesheet_link</span><span class="p">(</span><span class="s">&#39;/quick.css&#39;</span><span class="p">)</span><span class="cp">}</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="cp">}</span><span class="nt">&lt;/h1&gt;</span>

      <span class="cp">&lt;%</span> <span class="n">flashes</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">flash</span><span class="o">.</span><span class="n">pop_messages</span><span class="p">()</span> <span class="cp">%&gt;</span>
      <span class="cp">%</span> <span class="k">if</span> <span class="n">flashes</span><span class="p">:</span>
        <span class="cp">%</span> <span class="k">for</span> <span class="n">flash</span> <span class="ow">in</span> <span class="n">flashes</span><span class="p">:</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;flash&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="n">flash</span><span class="cp">}</span><span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">%</span><span class="k"> endfor</span>
      <span class="cp">%</span><span class="k"> endif</span>

      <span class="cp">${</span><span class="nb">next</span><span class="o">.</span><span class="n">body</span><span class="p">()</span><span class="cp">}</span>\

      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
        <span class="cp">${</span><span class="bp">self</span><span class="o">.</span><span class="n">footer</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;pylons.routes_dict&#39;</span><span class="p">][</span><span class="s">&#39;action&#39;</span><span class="p">])</span><span class="cp">}</span>\
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">## Don&#39;t show links that are redundant for particular pages</span>
<span class="cp">&lt;%</span><span class="nb">def</span> <span class="na">name=</span><span class="s">&quot;footer(action)&quot;</span><span class="cp">&gt;</span>\
  Return to the <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;FrontPage&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">))</span><span class="cp">}</span>
  <span class="cp">%</span> <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;index&quot;</span><span class="p">:</span>
    <span class="cp">&lt;%</span> <span class="k">return</span> <span class="cp">%&gt;</span>
  <span class="cp">%</span><span class="k"> endif</span>
  <span class="cp">%</span> <span class="k">if</span> <span class="n">action</span> <span class="o">!=</span> <span class="s">&#39;edit&#39;</span><span class="p">:</span>
    | <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;Edit &#39;</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">))</span><span class="cp">}</span>
  <span class="cp">%</span><span class="k"> endif</span>
  | <span class="cp">${</span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="s">&#39;Title List&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">(</span><span class="s">&#39;pages&#39;</span><span class="p">))</span><span class="cp">}</span>
<span class="cp">&lt;/%</span><span class="nb">def</span><span class="cp">&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&lt;%def</span> <span class="pre">name=&quot;footer(action&quot;&gt;</span></code> creates a Mako function for display logic. As you can see, the function builds the HTML for the footer, but doesn&#8217;t display the &#8216;Edit&#8217; link when you&#8217;re on the &#8216;Title List&#8217; page or already on an edit page. It also won&#8217;t show a &#8216;Title List&#8217; link when you&#8217;re already on that page. The <code class="docutils literal"><span class="pre">&lt;%</span> <span class="pre">...</span> <span class="pre">%&gt;</span></code> tags shown on the <code class="xref std std-keyword docutils literal"><span class="pre">return</span></code> statement are the final new piece of Mako syntax: they&#8217;re used much like the <code class="docutils literal"><span class="pre">${...}</span></code> tags, but for arbitrary Python code that does not directly render HTML. Also, the double hash (<code class="docutils literal"><span class="pre">##</span></code>) denotes a single-line comment in Mako.</p>
<p>So the <code class="xref py py-func docutils literal"><span class="pre">footer()</span></code> function is called in place of our old &#8216;static&#8217; footer markup. We pass it a value from <code class="docutils literal"><span class="pre">pylons.routes_dict</span></code> which holds the name of the action for the current request. The trailing <cite>\</cite> character just tells Mako not to render an extra newline.</p>
<p>If you visit <a class="reference external" href="http://127.0.0.1:5000/pages">http://127.0.0.1:5000/pages</a> you should see the full titles list and you should be able to visit each page.</p>
</div>
<div class="section" id="delete">
<h3><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code><a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>We need to add a <code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code> action that deletes pages submitted from <code class="file docutils literal"><span class="pre">templates/index.mako</span></code>, then returns us back to the list of titles (excluding those that were deleted):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@authenticate_form</span>
<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getall</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Page</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">titles</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
        <span class="n">Session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="n">Session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="c"># flash only after a successful commit</span>
    <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">&#39;Deleted </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">redirect_to</span><span class="p">(</span><span class="s">&#39;pages&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Again we use the <code class="xref py py-func docutils literal"><span class="pre">&#64;authenticate_form()</span></code> decorator along with <code class="xref py py-func docutils literal"><span class="pre">secure_form()</span></code> used in <code class="file docutils literal"><span class="pre">templates/index.mako</span></code>. We&#8217;re expecting potentially multiple titles, so we use <code class="xref py py-meth docutils literal"><span class="pre">request.POST.getall()</span></code> to return a list of titles. The titles are used to identify and load the <code class="xref py py-class docutils literal"><span class="pre">Page</span></code> objects, which are then deleted.</p>
<p>We use the SQL <code class="docutils literal"><span class="pre">IN</span></code> operator to match multiple titles in one query. We can do this via the more flexible <code class="xref py py-meth docutils literal"><span class="pre">filter()</span></code> method which can accept an <code class="xref py py-meth docutils literal"><span class="pre">in_()</span></code> clause created via the title column&#8217;s attribute.</p>
<p>The <code class="xref py py-meth docutils literal"><span class="pre">filter_by()</span></code> method we used in previous methods is a shortcut for the most typical filtering clauses. For example, the <code class="xref py py-meth docutils literal"><span class="pre">show()</span></code> method&#8217;s:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">page_q</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Page</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<p>After deleting the pages, the changes are committed, and only after successfully committing do we flash deletion messages. That way if there was a problem with the commit no flash messages are shown. Finally we redirect back to the index page, which re-renders the list of remaining titles.</p>
<p>Visit <a class="reference external" href="http://127.0.0.1:5000/index">http://127.0.0.1:5000/index</a> and have a go at deleting some pages. You may need to go back to the FrontPage and create some more if you get carried away!</p>
<p>That&#8217;s it! A working, production-ready wiki in 20 mins. You can visit <a class="reference external" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a> once more to admire your work.</p>
</div>
</div>
<div class="section" id="publishing-the-finished-product">
<h2>Publishing the Finished Product<a class="headerlink" href="#publishing-the-finished-product" title="Permalink to this headline">¶</a></h2>
<p>After all that hard work it would be good to distribute the finished package wouldn&#8217;t it? Luckily this is really easy in Pylons too. In the project root directory run this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python setup.py bdist_egg
</pre></div>
</div>
<p>This will create an egg file in the <code class="file docutils literal"><span class="pre">dist</span></code> directory which contains everything anyone needs to run your program. They can install it with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>easy_install QuickWiki-0.1.6-py2.5.egg
</pre></div>
</div>
<p>You should probably make eggs for each version of Python your users might require by running the above commands with both Python 2.4 and 2.5 to create both versions of the eggs.</p>
<p>If you want to register your project with PyPi at <a class="reference external" href="http://www.python.org/pypi">http://www.python.org/pypi</a> you can run the command below. <em>Please only do this with your own projects though because QuickWiki has already been registered!</em></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python setup.py register
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The PyPi authentication is very weak and passwords are transmitted in plain text. Don&#8217;t use any sign in details that you use for important applications as they could be easily intercepted.</p>
</div>
<p>You will be asked a number of questions and then the information you entered in <code class="file docutils literal"><span class="pre">setup.py</span></code> will be used as a basis for the page that is created.</p>
<p>Now visit <a class="reference external" href="http://www.python.org/pypi">http://www.python.org/pypi</a> to see the new index with your new package listed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A <a class="reference external" href="http://wiki.python.org/moin/CheeseShopTutorial">CheeseShop Tutorial</a> has been written and <a class="reference external" href="http://docs.python.org/dist/dist.html">full documentation on setup.py</a> is available from the Python website. You can even use <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> in the <code class="docutils literal"><span class="pre">description</span></code> and <code class="docutils literal"><span class="pre">long_description</span></code> areas of <code class="file docutils literal"><span class="pre">setup.py</span></code> to add formatting to the pages produced on PyPi (PyPi used to be called &#8220;the CheeseShop&#8221;). There is also <a class="reference external" href="http://www.python.org/~jeremy/weblog/030924.html">another tutorial here</a>.</p>
</div>
<p>Finally you can sign in to PyPi with the account details you used when you registered your application and upload the eggs you&#8217;ve created. If that seems too difficult you can even use this command which should be run for each version of Python supported to upload the eggs for you:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python setup.py bdist_egg upload
</pre></div>
</div>
<p>Before this will work you will need to create a <code class="file docutils literal"><span class="pre">.pypirc</span></code> file in your home directory containing your username and password so that the <strong class="command">upload</strong> command knows who to sign in as. It should look similar to this:</p>
<div class="highlight-ini"><div class="highlight"><pre>[server-login]
username: james
password: password
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This works on windows too but you will need to set your <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal"><span class="pre">HOME</span></code> environment variable first. If your home directory is <code class="file docutils literal"><span class="pre">C:Documents</span> <span class="pre">and</span> <span class="pre">SettingsJames</span></code> you would put your <code class="file docutils literal"><span class="pre">.pypirc</span></code> file in that directory and set your <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal"><span class="pre">HOME</span></code> environment variable with this command:</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre>&gt; SET <span class="nv">HOME</span><span class="o">=</span>C:<span class="se">\D</span>ocuments and Settings<span class="se">\J</span>ames
</pre></div>
</div>
<p>You can now use the <strong class="command">python setup.py bdist_egg upload</strong> as normal.</p>
<p>Now that the application is on PyPi anyone can install it with the <strong class="command">easy_install</strong> command exactly as we did right at the very start of this tutorial.</p>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>A final word about security.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Always set <code class="docutils literal"><span class="pre">debug</span> <span class="pre">=</span> <span class="pre">false</span></code> in configuration files for production sites and make sure your users do too.</p>
</div>
<p>You should NEVER run a production site accessible to the public with debug mode on. If there was a problem with your application and an interactive error page was shown, the visitor would be able to run any Python commands they liked in the same way you can when you are debugging. This would obviously allow them to do all sorts of malicious things so it is very important you turn off interactive debugging for production sites by setting <code class="docutils literal"><span class="pre">debug</span> <span class="pre">=</span> <span class="pre">false</span></code> in configuration files and also that you make users of your software do the same.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ve gone through the whole cycle of creating and distributing a Pylons application looking at setup and configuration, routing, models, controllers and templates. Hopefully you have an idea of how powerful Pylons is and, once you get used to the concepts introduced in this tutorial, how easy it is to create sophisticated, distributable applications with Pylons.</p>
<p>That&#8217;s it, I hope you found the tutorial useful. You are encouraged to email any comments to the <a class="reference external" href="http://groups.google.com/group/pylons-discuss">Pylons mailing list</a> where they will be welcomed.</p>
</div>
<div class="section" id="thanks">
<h2>Thanks<a class="headerlink" href="#thanks" title="Permalink to this headline">¶</a></h2>
<p>A big thanks to Ches Martin for updating this document and the QuickWiki project for Pylons 0.9.6 / Pylons 0.9.7 / QuickWiki 0.1.5 / QuickWiki 0.1.6, Graham Higgins, and others in the Pylons community who contributed bug fixes and suggestions.</p>
</div>
<div class="section" id="todo">
<h2>Todo<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Provide <strong class="command">paster shell</strong> examples</li>
<li>Incorporate testing into the tutorial</li>
<li>Explain Ches&#8217;s <code class="xref py py-meth docutils literal"><span class="pre">validate_title()</span></code> method in the actual QuickWiki project</li>
<li>Provide snapshots of every file modified at each step, to help resolve mistakes</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quickwiki tutorial</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#starting-at-the-end">Starting at the End</a></li>
<li><a class="reference internal" href="#developing-quickwiki">Developing QuickWiki</a></li>
<li><a class="reference internal" href="#the-model">The Model</a></li>
<li><a class="reference internal" href="#application-setup">Application Setup</a></li>
<li><a class="reference internal" href="#templates">Templates</a></li>
<li><a class="reference internal" href="#routing">Routing</a></li>
<li><a class="reference internal" href="#controllers">Controllers</a><ul>
<li><a class="reference internal" href="#show"><code class="docutils literal"><span class="pre">show()</span></code></a></li>
<li><a class="reference internal" href="#edit"><code class="docutils literal"><span class="pre">edit()</span></code></a></li>
<li><a class="reference internal" href="#save"><code class="docutils literal"><span class="pre">save()</span></code></a></li>
<li><a class="reference internal" href="#index"><code class="docutils literal"><span class="pre">index()</span></code></a></li>
<li><a class="reference internal" href="#delete"><code class="docutils literal"><span class="pre">delete()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#publishing-the-finished-product">Publishing the Finished Product</a></li>
<li><a class="reference internal" href="#security">Security</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#thanks">Thanks</a></li>
<li><a class="reference internal" href="#todo">Todo</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    	<li><a href="../index.html">Pylons Framework 1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2008-2011, Ben Bangert, James Gardner, Philip Jenvey.
      Last updated on Jun 10, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>